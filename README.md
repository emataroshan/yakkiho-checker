# yakkiho-checker
薬機法チェックアプリ

**　アプリソフト　**
    1.data_processing.py（NGワード処理ロジックプロンプト）
    2.ui.py（UI（ユーザーインターフェース）処理プロンプト）
    3.NGword.json（NGワードチェック用JSONファイル）
    4.config.py（プレースホルダー）
    5.debug.log（デバッグ用ログ）


【 管理用テキストデータ 】
    → NGword.jsonの元となる全ての情報が入ったデータ。

【 NGword_output.xlsx 】
    → 管理用テキストデータに対し、以下のことができるマスタファイル
        ・グループ追加
        ・対象ワード追加（考える余地あり、本当にここでやるのがベスト？？）
        ・理由・改善提案・適正表現例の設定　
        ・用途区分・製品名フラグの設定と追加

――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――

# 【 insert_flags.py 】　

## 概要

`insert_flags.py` は、既存のテキストファイル内にある「用途区分」「製品名」のフラグ情報を、Excel ファイルの最新情報に置き換えるバッチスクリプトです。

* GUI ダイアログで入力フォルダ・Excel ファイル・出力フォルダを選択
* Excel を読み込み、(サブカテゴリ, グループ) ごとの行をキャッシュ
* テキストを「サブカテゴリ」ブロックに分割し、各「グループ」ヘッダー以下を Excel 情報に更新
* 処理状況はログに記録し、エラー時は画面表示

## 必要要件

* Python 3.7 以上
* pip インストール済み

## 実行前の注意点

* usage_set に新しく追加した用途（列名）を忘れずに追加
* fixed_cols は必要に応じてカラム名を調整（Excelの構成が変わった場合）

### Python ライブラリ

```bash
pip install pandas openpyxl
```

（`tkinter` は標準ライブラリとして同梱されています）

## ファイル構成

```
project/
├── insert_flags.py          # メインスクリプト
├── insert_flags.log         # 実行ログ (INFO, ERROR)
├── examples/                # サンプルテキスト・Excel
│   ├── texts/               # 入力用 .txt
│   └── data.xlsx            # Excel フラグ定義
└── README.md                # 本ファイル
```

## 使い方

```bash
python insert_flags.py
```

1. 「新形式テキスト格納フォルダを選択」ダイアログで、置換対象の .txt ファイルが入ったフォルダを指定
2. 「Excel を選択」ダイアログで、用途区分／製品名フラグ定義の Excel ファイルを指定
3. 「出力先フォルダを選択」ダイアログで、更新後ファイルを書き出すフォルダを指定
4. 処理が終了するとコンソールに完了メッセージが表示されます

## ログ

* 全般ログ: `insert_flags.log` に INFO および ERROR レベルを記録
* コンソール出力: ERROR レベルのみ表示

ログ例:
```
2025-05-15 14:23:01 INFO: ✔ subcat1.txt を更新 -> output/subcat1.txt
2025-05-15 14:23:02 ERROR: subcat2.txt: フラグ取得失敗: サブカテゴリ='A', グループ='X'
```

## カスタマイズ

* `usage_set` に新しい用途区分を追加
* Excel のカラム名が変更された場合は `fixed_cols` を更新
* 正規表現パターンは `parse_sections()` 内で調整可能

## 開発／テスト

* フラグ置換ロジックは `replace_flags()` を単体テスト
* 入出力はモックしてテスト用フォルダで実行確認

## ライセンス

MIT ライセンス


――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――